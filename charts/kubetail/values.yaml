# Default values for kubetail chart.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# -- Override the chart's computed fullname
fullnameOverride: null

# -- Overrides the chart's name
nameOverride: null

# -- Override the release's namespace
namespaceOverride: null

# ###########################################################################################
#
# Base config for Kubetail app including Kubernetes configurations
#
# ###########################################################################################

kubetail:
  # -- Auth mode lets you specify Kubetail's authentication mode
  # There are 2 options:
  # - cluster: Uses cluster RBAC
  # - token: Uses user-provided token
  authMode: cluster

  # --- Restrict namespaces
  allowedNamespaces: []

  # -- config file contents (see https://github.com/kubetail-org/kubetail for defaults)
  config: |
    server:
      addr: :4000
      session:
        secret: ${KUBETAIL_SERVER_CSRF_SECRET}
      csrf:
        secret: ${KUBETAIL_SERVER_SESSION_SECRET}
      logging:
        access-log:
          hide-health-checks: true
    agent:
      addr: :50051

  # ########################################################################################
  #
  # Shared resource configurations
  #
  # ########################################################################################

  configMap:
    # -- Overrides the ConfigMap resource name whose default is the chart's computed fullname
    name: null
    # -- Additional annotations
    annotations: {}
    # -- Additional labels
    labels: {}

  ingress:
    # If true, adds Ingress resource
    enabled: false
    # -- Overrides the ClusterRole resource name whose default is the chart's computed fullname
    name: null
    # -- Additional annotations
    annotations: {}
    # -- Additional labels
    labels: {}
    # -- Rules
    rules: []
    # -- TLS
    tls: []
    # -- Class name
    className: null

  # ########################################################################################
  #
  # Server resource configurations
  #
  # ########################################################################################
  server:
    image:
      # -- Image registry
      registry: docker.io
      # -- Image repository
      repository: kubetail/kubetail-server
      # -- Overrides the image tag whose default is the chart's appVersion
      tag: null
      # -- Overrides the image tag with an image digest
      digest: null
      # -- Docker image pull policy
      pullPolicy: IfNotPresent

    secret:
      # If true, add Secret resource with configured values
      enabled: true
      # -- Overrides the Secret resource name whose default is the chart's computed fullname
      name: null
      # -- Additional annotations
      annotations: {}
      # -- Additional labels
      labels: {}
      # -- base64-encoded secret value for server csrf (will be autogenerated if null)
      KUBETAIL_SERVER_CSRF_SECRET: null
      # -- base64-encoded secret value for server session (will be autogenerated if null)
      KUBETAIL_SERVER_SESSION_SECRET: null

    clusterRole:
      # -- Overrides the ClusterRole resource name whose default is the chart's computed fullname
      name: null
      # -- Additional annotations
      annotations: {}
      # -- Additional labels
      labels: {}

    clusterRoleBinding:
      # -- Overrides the ClusterRoleBinding resource name whose default is the chart's computed fullname
      name: null
      # -- Additional annotations
      annotations: {}
      # -- Additional labels
      labels: {}

    deployment:
      # -- Overrides the Deployment resource name whose default is the chart's computed fullname
      name: null
      # -- Additional annotations
      annotations: {}
      # -- Additional labels
      labels: {}
      # -- Replicas
      replicas: 1
      # -- Revision history limit
      revisionHistoryLimit: 5
      # -- Strategy
      strategy:
        type: RollingUpdate

    podTemplate:
      # -- Additional annotations
      annotations: {}
      # -- Additional labels
      labels: {}
      # -- Affinity for pods
      affinity: {}
      # -- AutomountServiceAccounttoken for pods
      automountServiceAccountToken: true
      # -- Additional env
      env: {}
      # -- Additional envFrom
      envFrom: {}
      # -- Additional args
      args: []
      # -- Port number
      port: 4000
      # -- Liveness probe
      livenessProbe:
        httpGet:
          scheme: HTTP
          path: /healthz
          port: kubetail
        initialDelaySeconds: 30
        timeoutSeconds: 30
        periodSeconds: 10
        failureThreshold: 3
      # -- Readiness probe
      readinessProbe:
        httpGet:
          scheme: HTTP
          path: /healthz
          port: kubetail
        initialDelaySeconds: 30
        timeoutSeconds: 30
        periodSeconds: 10
        failureThreshold: 3
      # -- Resources
      resources: {}
      # -- Security context
      securityContext:
        runAsUser: 10001
        runAsGroup: 10001
        fsGroup: 10001
        runAsNonRoot: true
        seccompProfile:
          type: RuntimeDefault
      # -- Kubetail container's security context
      containerSecurityContext:
        allowPrivilegeEscalation: false
        capabilities:
          drop:
            - ALL
        readOnlyRootFilesystem: true
      # -- volumes
      volumes: []
      # -- volume mounts
      volumeMounts: []
      # -- PriorityClassName
      priorityClassName: null
      # -- Node selector
      nodeSelector: {}
      # -- Tolerations
      tolerations: []

    role:
      # -- Overrides Role resources' name whose default is the chart's computed fullname
      name: null
      # -- Additional annotations
      annotations: {}
      # -- Additional labels
      labels: {}

    roleBinding:
      # -- Overrides the RoleBinding resources' name whose default is the chart's computed fullname
      name: null
      # -- Additional annotations
      annotations: {}
      # -- Additional labels
      labels: {}

    service:
      # -- Overrides the Service resource name whose default is the chart's computed fullname
      name: null
      # -- Additional annotations
      annotations: {}
      # -- Additional labels
      labels: {}
      # -- Port
      port: 80

    serviceAccount:
      # -- Overrides the Service resource name whose default is the chart's computed fullname
      name: null
      # -- Additional annotations
      annotations: {}
      # -- Additional labels
      labels: {}
      # -- AutomountServiceAccountToken
      automountServiceAccountToken: true

  # ########################################################################################
  #
  # Agent resource configurations
  #
  # ########################################################################################
  agent:
    image:
      # -- Image registry
      registry: docker.io
      # -- Image repository
      repository: kubetail/kubetail-agent
      # -- Overrides the image tag whose default is the chart's appVersion
      tag: null
      # -- Overrides the image tag with an image digest
      digest: null
      # -- Docker image pull policy
      pullPolicy: IfNotPresent

    clusterRole:
      # -- Overrides the ClusterRole resource name whose default is the chart's computed fullname
      name: null
      # -- Additional annotations
      annotations: {}
      # -- Additional labels
      labels: {}

    clusterRoleBinding:
      # -- Overrides the ClusterRoleBinding resource name whose default is the chart's computed fullname
      name: null
      # -- Additional annotations
      annotations: {}
      # -- Additional labels
      labels: {}

    daemonSet:
      # -- Overrides the Deployment resource name whose default is the chart's computed fullname
      name: null
      # -- Additional annotations
      annotations: {}
      # -- Additional labels
      labels: {}

    podTemplate:
      # -- Additional annotations
      annotations: {}
      # -- Additional labels
      labels: {}
      # -- Affinity for pods
      affinity: {}
      # -- AutomountServiceAccounttoken for pods
      automountServiceAccountToken: true
      # -- Additional env
      env: {}
      # -- Additional envFrom
      envFrom: {}
      # -- Additional args
      args: []
      # -- Port number
      port: 50051
      # -- Liveness probe
      livenessProbe:
        grpc:
          port: 50051
        initialDelaySeconds: 5
        timeoutSeconds: 30
        periodSeconds: 3
        failureThreshold: 3
      # -- Readiness probe
      readinessProbe:
        grpc:
          port: 50051
        initialDelaySeconds: 5
        timeoutSeconds: 30
        periodSeconds: 3
        failureThreshold: 3
      # -- Resources
      resources: {}
      # -- Security context
      securityContext:
        fsGroup: 0  # Set file system group ownership to root (to match /var/log permissions)
      ## -- Kubetail agent container's security context (permissions necessary for accessing host's /var/log)
      containerSecurityContext:
        runAsUser: 0
        runAsGroup: 0
        allowPrivilegeEscalation: false
        readOnlyRootFilesystem: true
        seccompProfile:
          type: RuntimeDefault
        capabilities:
          drop:
            - ALL
      # -- volumes
      volumes: []
      # -- volume mounts
      volumeMounts: []
      # -- PriorityClassName
      priorityClassName: null
      # -- Node selector
      nodeSelector: {}
      # -- Tolerations
      tolerations: []

    networkPolicy:
      # If true, add NetworkPolicy resource with configured values
      enabled: true
      # -- Overrides the NetworkPolicy resource name whose default is the chart's computed fullname
      name: null
      # -- Additional annotations
      annotations: {}
      # -- Additional labels
      labels: {}

    role:
      # -- Overrides Role resources' name whose default is the chart's computed fullname
      name: null
      # -- Additional annotations
      annotations: {}
      # -- Additional labels
      labels: {}

    roleBinding:
      # -- Overrides the RoleBinding resources' name whose default is the chart's computed fullname
      name: null
      # -- Additional annotations
      annotations: {}
      # -- Additional labels
      labels: {}

    service:
      # -- Overrides the Service resource name whose default is the chart's computed fullname
      name: null
      # -- Additional annotations
      annotations: {}
      # -- Additional labels
      labels: {}
      # -- Port
      port: 80

    serviceAccount:
      # -- Overrides the Service resource name whose default is the chart's computed fullname
      name: null
      # -- Additional annotations
      annotations: {}
      # -- Additional labels
      labels: {}
      # -- AutomountServiceAccountToken
      automountServiceAccountToken: true
