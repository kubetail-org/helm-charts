# Default values for kubetail chart.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# -- Override the chart's computed fullname
fullnameOverride: null

# -- Overrides the chart's name
nameOverride: null

# -- Override the release's namespace
namespaceOverride: null

# ###########################################################################################
#
# Base config for Kubetail app including Kubernetes configurations
#
# ###########################################################################################

kubetail:
  # -- Auth mode lets you specify Kubetail's authentication mode (cluster, token)
  authMode: cluster

  # --- Restrict namespaces
  allowedNamespaces: []

  secrets:
    # -- Base64-encoded secret value for server csrf (will be autogenerated if null)
    KUBETAIL_SERVER_CSRF_SECRET: null
    # -- Base64-encoded secret value for server session (will be autogenerated if null)
    KUBETAIL_SERVER_SESSION_SECRET: null

  server:
    runtimeConfig:
      # -- Sets the url path prefix (useful for deploying on a sub-path behind a reverse proxy)
      basePath: /
      # -- Sets the mode for the Gin framework
      ginMode: release
      # -- CSRF options
      csrf: 
        # -- Enables/disables csrf protection
        enabled: true
        # -- Sets the name to use for token in forms
        fieldName: csrf_token
        # -- Cookie options
        cookie:
          # -- Sets the cookie `name` property
          name: csrf
          # -- Sets the cookie `path` property
          path: /
          # -- Sets the cookie `domain` property
          domain: null
          # -- Sets the cookie max age (in seconds)
          maxAge: 43200
          # -- Sets the cookie `secure` property
          secure: false
          # -- Sets the cookie `httpOnly` property
          httpOnly: true
          # -- Sets the cookie `sameSite` property (strict, lax, none)
          sameSite: strict
      # -- Logging options
      logging:
        # -- Enables/disables logging
        enabled: true
        # -- Sets the logging level (debug, info, warn, error, disabled)
        level: info
        # -- Sets the logging format (json, pretty)
        format: json
        # -- Access log options
        accessLog:
          # -- Enables/disables logging
          enabled: true
          # -- Hides health checks from access log
          hideHealthChecks: true
      # -- Session options
      session:
        # -- Cookie options
        cookie:
          # -- Sets the cookie `name` property
          name: csrf
          # -- Sets the cookie `path` property
          path: /
          # -- Sets the cookie `domain` property
          domain: null
          # -- Sets the cookie max age (in seconds)
          maxAge: 1092000
          # -- Sets the cookie `secure` property
          secure: false
          # -- Sets the cookie `httpOnly` property
          httpOnly: true
          # -- Sets the cookie `sameSite` property (strict, lax none)
          sameSite: lax
      # -- TLS options
      tls:
        # -- Enables/disables TLS termination
        enabled: false
        # -- Path to TLS certificate file
        certFile: null
        # -- Path to TLS key file
        keyFile: null

    image:
      # -- Image registry
      registry: docker.io
      # -- Image repository
      repository: kubetail/kubetail-server
      # -- Overrides the image tag whose default is the chart's appVersion
      tag: null
      # -- Overrides the image tag with an image digest
      digest: null
      # -- Docker image pull policy
      pullPolicy: IfNotPresent

    configMap:
      # -- Overrides the ConfigMap resource name whose default is based on the chart's computed fullname
      name: null
      # -- Additional annotations
      annotations: {}
      # -- Additional labels
      labels: {}

    deployment:
      # -- Overrides the Deployment resource name whose default is based on the chart's computed fullname
      name: null
      # -- Additional annotations
      annotations: {}
      # -- Additional labels
      labels: {}
      # -- Replicas
      replicas: 1
      # -- Revision history limit
      revisionHistoryLimit: 5
      # -- Strategy
      strategy:
        type: RollingUpdate

    ingress:
      # -- If true, adds Ingress resource
      enabled: false
      # -- Overrides the ClusterRole resource name whose default is based on the chart's computed fullname
      name: null
      # -- Additional annotations
      annotations: {}
      # -- Additional labels
      labels: {}
      # -- Rules
      rules: []
      # -- TLS
      tls: []
      # -- Class name
      className: null

    podTemplate:
      # -- Additional annotations
      annotations: {}
      # -- Additional labels
      labels: {}
      # -- Affinity for pods
      affinity: {}
      # -- AutomountServiceAccounttoken for pods
      automountServiceAccountToken: true
      # -- Additional env
      env:
      - name: GIN_MODE
        value: "release"
      # -- Additional envFrom
      envFrom: {}
      # -- Additional args
      args: []
      # -- Ports
      ports:
      - name: kubetail-server
        protocol: TCP
        containerPort: 4000
      # -- Liveness probe
      livenessProbe:
        httpGet:
          scheme: HTTP
          path: /healthz
          port: kubetail-server
        initialDelaySeconds: 30
        timeoutSeconds: 30
        periodSeconds: 10
        failureThreshold: 3
      # -- Readiness probe
      readinessProbe:
        httpGet:
          scheme: HTTP
          path: /healthz
          port: kubetail
        initialDelaySeconds: 30
        timeoutSeconds: 30
        periodSeconds: 10
        failureThreshold: 3
      # -- Resources
      resources: {}
      # -- Security context
      securityContext:
        runAsUser: 10001
        runAsGroup: 10001
        fsGroup: 10001
        runAsNonRoot: true
        seccompProfile:
          type: RuntimeDefault
      # -- Kubetail container's security context
      containerSecurityContext:
        allowPrivilegeEscalation: false
        capabilities:
          drop:
            - ALL
        readOnlyRootFilesystem: true
      # -- volumes
      volumes: []
      # -- volume mounts
      volumeMounts: []
      # -- PriorityClassName
      priorityClassName: null
      # -- Node selector
      nodeSelector: {}
      # -- Tolerations
      tolerations: []

    rbac:
      # -- Overrides RBAC resources' name whose default is based on the chart's computed fullname
      name: null
      # -- Additional annotations
      annotations: {}
      # -- Additional labels
      labels: {}

    secret:
      # -- If true, add Secret resource with configured values
      enabled: true
      # -- Overrides the Secret resource name whose default is based on the chart's computed fullname
      name: null
      # -- Additional annotations
      annotations: {}
      # -- Additional labels
      labels: {}

    service:
      # -- If true, add Service resource with configured values
      enabled: true
      # -- Overrides the Service resource name whose default is based on the chart's computed fullname
      name: null
      # -- Additional annotations
      annotations: {}
      # -- Additional labels
      labels: {}
      # -- Port
      port: 80

    serviceAccount:
      # -- Overrides the Service resource name whose default is based on the chart's computed fullname
      name: null
      # -- Additional annotations
      annotations: {}
      # -- Additional labels
      labels: {}
      # -- AutomountServiceAccountToken
      automountServiceAccountToken: true

  agent:
    runtimeConfig:
      # -- Logging options
      logging:
        # -- Enables/disables logging
        enabled: true
        # -- Sets the logging level (debug, info, warn, error, disabled)
        level: info
        # -- Sets the logging format (json, pretty)
        format: json
      # -- TLS options
      tls:
        # -- Enables/disables TLS termination
        enabled: false
        # -- Path to TLS certificate file
        certFile: null
        # -- Path to TLS key file
        keyFile: null

    image:
      # -- Image registry
      registry: docker.io
      # -- Image repository
      repository: kubetail/kubetail-agent
      # -- Overrides the image tag whose default is the chart's appVersion
      tag: null
      # -- Overrides the image tag with an image digest
      digest: null
      # -- Docker image pull policy
      pullPolicy: IfNotPresent

    configMap:
      # -- Overrides the ConfigMap resource name whose default is based on the chart's computed fullname
      name: null
      # -- Additional annotations
      annotations: {}
      # -- Additional labels
      labels: {}
  
    daemonSet:
      # -- Overrides the Deployment resource name whose default is based on the chart's computed fullname
      name: null
      # -- Additional annotations
      annotations: {}
      # -- Additional labels
      labels: {}

    networkPolicy:
      # -- If true, add NetworkPolicy resource with configured values
      enabled: true
      # -- Overrides the NetworkPolicy resource name whose default is based on the chart's computed fullname
      name: null
      # -- Additional annotations
      annotations: {}
      # -- Additional labels
      labels: {}

    podTemplate:
      # -- Additional annotations
      annotations: {}
      # -- Additional labels
      labels: {}
      # -- Affinity for pods
      affinity: {}
      # -- AutomountServiceAccounttoken for pods
      automountServiceAccountToken: true
      # -- Additional env
      env: {}
      # -- Additional envFrom
      envFrom: {}
      # -- Additional args
      args: []
      # -- Ports
      ports:
      - name: kubetail-agent
        protocol: TCP
        containerPort: 50051
      # -- Liveness probe
      livenessProbe:
        grpc:
          port: 50051
        initialDelaySeconds: 5
        timeoutSeconds: 30
        periodSeconds: 3
        failureThreshold: 3
      # -- Readiness probe
      readinessProbe:
        grpc:
          port: 50051
        initialDelaySeconds: 5
        timeoutSeconds: 30
        periodSeconds: 3
        failureThreshold: 3
      # -- Resources
      resources: {}
      # -- Security context
      securityContext:
        fsGroup: 0  # Set file system group ownership to root (to match /var/log permissions)
      ## -- Kubetail agent container's security context (permissions necessary for accessing host's /var/log)
      containerSecurityContext:
        runAsUser: 0
        runAsGroup: 0
        allowPrivilegeEscalation: false
        readOnlyRootFilesystem: true
        seccompProfile:
          type: RuntimeDefault
        capabilities:
          drop:
            - ALL
      # -- volumes
      volumes: []
      # -- volume mounts
      volumeMounts: []
      # -- PriorityClassName
      priorityClassName: null
      # -- Node selector
      nodeSelector: {}
      # -- Tolerations
      tolerations:
      - key: "node-role.kubernetes.io/master"
        operator: "Exists"
        effect: "NoSchedule"
      - key: "node-role.kubernetes.io/control-plane"
        operator: "Exists"
        effect: "NoSchedule"
    
    rbac:
      # -- Overrides RBAC resources' name whose default is based on the chart's computed fullname
      name: null
      # -- Additional annotations
      annotations: {}
      # -- Additional labels
      labels: {}

    service:
      # -- Overrides the Service resource name whose default is based on the chart's computed fullname
      name: null
      # -- Additional annotations
      annotations: {}
      # -- Additional labels
      labels: {}

    serviceAccount:
      # -- Overrides the Service resource name whose default is based on the chart's computed fullname
      name: null
      # -- Additional annotations
      annotations: {}
      # -- Additional labels
      labels: {}
      # -- AutomountServiceAccountToken
      automountServiceAccountToken: true
